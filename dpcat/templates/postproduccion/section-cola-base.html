{% extends "postproduccion/base-2-1.html" %}

{% block page-title %}Cola de proceso de producciones{% endblock %}
{% block section-class %} {% endblock %}
{% block section-title %}<h1>Cola de proceso de producciones</h1>{% endblock %}
{% block section-description %}<p>Listado de producciones que est&aacute;n actualmente en la cola de procesado del sistema.</p>{% endblock %}

{% block section-content %}
<div id="progressbar"></div>
<div id="progressbartext"></div>
<table id="tabla" class="cola">
    <thead>
        <th class="id">ID</th>
        <th class="type">Informaci&oacute;n</th>
        <th class="date">Fecha</th>
        <th>T&iacute;tulo</th>
        <th class="log">Log</th>
    </thead>
    <tbody>
    </tbody>
</table>
{% endblock %}

{% block section-widget %}
    <div id="content-right">
        <div class="column">
            <div class="portlet">
                <div class="portlet-header">Informaci&oacute;n de inter&eacute;s</div>
                <div class="portlet-content">
                    <ul> 
                        <li class="tip">Poner descripci&oacute;n o enlaces sobre esta tabla</li>
                    </ul>
                </div>
            </div>
        </div>     
    </div>
{% endblock %}

{% block page-script %}
    <script type="text/javascript">
        function creaLinea(data) {
            str = '<td class="id">'+data['id']+'</td>';
            str += '<td><ul><li>Tipo: '+data['tipo']+'</li>';
            str += '<li>Estado: '+data['status']+'<br/>';
            if (data['progress']) {
                str += '<div id="progressbar'+data['id']+'"></div>';
                str += '<div id="progressbartext">'+data['progress']+' %</div>';
            }
            str += '</li></td>';
            if (data['comienzo'] || data['fin']) {
                str += '<td class="date"><ul>';
                if (data['comienzo']) {
                    str += '<li>'+data['comienzo']+' - Inicio</li>';
                }
                if (data['fin']) {                    
                   str += '<li>'+data['fin']+' - Fin</li>';
                }
                str +='</ul></td>';
            } else {
                str += '<td class="date">&nbsp;</td>';
            }

            str += '<td><a class="link" href="' + data['v-url'] + '">' + data['v-titulo'] + '</a></td>';

            if (data['logurl']) {
                str += '<td class="log"><a class="chain" href="' + data['logurl'] +'" target="_blank">' + data['logfile'] +'</a></td>';
            } else {
                str += '<td class="log">&nbsp;</td>';
            }
            return str;
        }

        function creaTabla(data) {
            str = '<tbody>';
            for (var i = 0; i < data.length; i++)
                str += '<tr>' + creaLinea(data[i]) + '</tr>';
            str += '</tbody>';
            return str;
        }

        function mostrarProgreso(data) {
            for (var i = 0; i < data.length; i++) {
                if (data[i]['progress'] >= 0) {
                    $('#progressbar' + data[i]['id']).progressbar ({
                        value: data[i]['progress'] 
                    })
                }
            }
        }

        function refrescar() {
            $.getJSON('/postproduccion/cola_listado/', function(data) {
                $(creaTabla(data)).replaceAll("tbody"); 
                mostrarProgreso(data);
            });
            
            setTimeout("refrescar();", 1000);
        }

        $(document).ready( function() {
            refrescar();
        });

    </script>

{% endblock %}

